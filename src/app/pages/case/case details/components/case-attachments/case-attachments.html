<section class="section">

    @if(attachments?.length) {
    <header class="d-myflex my-justi mb-2">
        <h3>المرفقات</h3>
        <button (click)="openAddAttachment()" class="btn bg-sub">إضافة مرفق</button>
    </header>

    <div class="row justify-content-between mb-3">
        <!-- Enhanced Search Section -->
        <div class="col-4 mb-2">
            <input type="text" placeholder="ابحث في المرفقات..." (keyup)="filter($event)" class="form-control">
        </div>
    </div>
    <div class="table-responsive tb-container">
        <table matSort mat-table [dataSource]="attachmentsDataSource" class="mat-elevation-z8 table">

            <!-- Index Column -->
            <ng-container [matColumnDef]="displayedColumns[0]">
                <th mat-header-cell *matHeaderCellDef>#</th>
                <td mat-cell *matCellDef="let i = index">
                    {{ helper.getCurrentRowNumber(i, paginator?.pageIndex || 0, paginator?.pageSize || 20) }}
                </td>
            </ng-container>

            <!-- Attachment Name Column with Sort -->
            <ng-container [matColumnDef]="displayedColumns[1]">
                <th mat-header-cell *matHeaderCellDef [mat-sort-header]="displayedColumns[1]">اسم المرفق</th>
                <td mat-cell *matCellDef="let element">
                    <span>{{element.name}}</span>
                </td>
            </ng-container>

            <!-- Upload Date Column with Sort -->
            <ng-container [matColumnDef]="displayedColumns[2]">
                <th mat-header-cell *matHeaderCellDef [mat-sort-header]="displayedColumns[2]">تاريخ رفع المرفق</th>
                <td mat-cell *matCellDef="let element">
                    <span>{{element.rasiedDate | date:'dd/MM/yyyy'}}</span>
                </td>
            </ng-container>

            <!-- Employee Column with Sort -->
            <ng-container [matColumnDef]="displayedColumns[3]">
                <th mat-header-cell *matHeaderCellDef [mat-sort-header]="displayedColumns[3]">الموظف</th>
                <td mat-cell *matCellDef="let element">
                    <span>{{element.raisedBy}}</span>
                </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container [matColumnDef]="displayedColumns[4]">
                <th mat-header-cell *matHeaderCellDef>الإجراءات</th>
                <td mat-cell *matCellDef="let element" class="d-flex gap-2">
                    <button class="btn btn-sm bg-main" (click)="downloadAttachment(element)" title="تحميل">
                        <i class="fa-solid fa-download"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-primary" (click)="viewAttachment(element)" title="عرض">
                        <i class="fa-solid fa-eye"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-danger" (click)="deleteAttachment(element)" title="حذف">
                        <i class="fa-solid fa-trash"></i>
                    </button>
                </td>
            </ng-container>

            <!-- Header and Row Definitions -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <!-- Pagination -->
        <mat-paginator [pageSizeOptions]="[10, 20, 30, 40, 50]" (page)="handlePage($event)" [pageIndex]="currentPage"
            [length]="attachmentsDataSource.filteredData.length" pageSize="20">
        </mat-paginator>
    </div>
    } @else {
    <app-empty-table title="لا توجد مرفقات" msg="لم يتم رفع أي مرفقات بعد" [hasAction]="true" action="أضف مرفق"
        (actionClicked)="openAddAttachment()"></app-empty-table>
    }
</section>